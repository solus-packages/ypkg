From 951f4974af6cb2a98b4d2c1e8349a39fc65c9e2d Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 17 Apr 2016 08:21:12 +0100
Subject: [PATCH] Correctly export PKG_CONFIG_PATH during emul32 builds

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 ypkg2/__init__.py | 2 ++
 ypkg2/examine.py  | 3 +--
 ypkg2/main.py     | 2 ++
 3 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/ypkg2/__init__.py b/ypkg2/__init__.py
index a37e2b8..ffc103c 100644
--- a/ypkg2/__init__.py
+++ b/ypkg2/__init__.py
@@ -38,3 +38,5 @@ global packager_email
 
 packager_name = "Automated Package Build"
 packager_email = "no.email.set.in.config"
+
+EMUL32PC = "/usr/lib32/pkgconfig:/usr/share/pkgconfig:/usr/lib/pkgconfig"
diff --git a/ypkg2/examine.py b/ypkg2/examine.py
index 2791d74..ddf3c1b 100644
--- a/ypkg2/examine.py
+++ b/ypkg2/examine.py
@@ -14,6 +14,7 @@
 from . import console_ui
 from .metadata import readlink
 from . import remove_prefix
+from . import EMUL32PC
 import magic
 import re
 import os
@@ -31,8 +32,6 @@ shared_lib = re.compile(r".*Shared library: \[(.*)\].*")
 r_path = re.compile(r".*Library rpath: \[(.*)\].*")
 r_soname = re.compile(r".*Library soname: \[(.*)\].*")
 
-EMUL32PC = "/usr/lib32/pkgconfig:/usr/share/pkgconfig:/usr/lib/pkgconfig"
-
 
 def is_pkgconfig_file(pretty, mgs):
     """ Simple as it sounds, work out if this is a pkgconfig file """
diff --git a/ypkg2/main.py b/ypkg2/main.py
index 1210219..189b48b 100644
--- a/ypkg2/main.py
+++ b/ypkg2/main.py
@@ -22,6 +22,7 @@ from .examine import PackageExaminer
 from . import metadata
 from .dependencies import DependencyResolver
 from . import packager_name, packager_email
+from . import EMUL32PC
 
 import ypkg2
 
@@ -110,6 +111,7 @@ def execute_step(context, step, step_n, work_dir):
     script = ScriptGenerator(context, context.spec, work_dir)
     if context.emul32:
         script.define_export("EMUL32BUILD", "1")
+        script.define_export("PKG_CONFIG_PATH", EMUL32PC)
 
     exports = script.emit_exports()
 
-- 
2.8.1

