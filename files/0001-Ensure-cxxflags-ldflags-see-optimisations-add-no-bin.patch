From c0891096b7138af9e3a24c79f4bf036611fa39ca Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 17 Apr 2016 05:17:31 +0100
Subject: [PATCH 1/2] Ensure cxxflags/ldflags, see optimisations, add
 no-bind-now support

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 ypkg2/ypkgcontext.py | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/ypkg2/ypkgcontext.py b/ypkg2/ypkgcontext.py
index 0e5feee..bf36324 100644
--- a/ypkg2/ypkgcontext.py
+++ b/ypkg2/ypkgcontext.py
@@ -23,6 +23,7 @@ SPEED_FLAGS = "-flto -ffunction-sections -fno-semantic-interposition -O3"
 SIZE_FLAGS = "-Os -ffunction-sections"
 PGO_GEN_FLAGS = "-fprofile-generate -fprofile-dir=\"{}\""
 PGO_USE_FLAGS = "-fprofile-use -fprofile-dir=\"{}\" -fprofile-correction"
+BIND_NOW_FLAGS = ["-Wl,-z,now"]
 
 
 class Flags:
@@ -61,6 +62,8 @@ class Flags:
             newflags.extend(SPEED_FLAGS.split(" "))
         elif opt_type == "size":
             newflags.extend(SIZE_FLAGS.split(" "))
+        elif opt_type == "no-bind-now":
+            newflags = Flags.filter_flags(f, BIND_NOW_FLAGS)
         else:
             console_ui.emit_warning("Flags", "Uknown optimization: {}".
                                     format(opt_type))
@@ -222,6 +225,10 @@ class YpkgContext:
         if self.spec.pkg_optimize is not None:
             self.build.cflags = Flags.optimize_flags(self.build.cflags,
                                                      self.spec.pkg_optimize)
+            self.build.cxxflags = Flags.optimize_flags(self.build.cxxflags,
+                                                       self.spec.pkg_optimize)
+            self.build.ldflags = Flags.optimize_flags(self.build.ldflags,
+                                                      self.spec.pkg_optimize)
 
         if self.emul32:
             ncflags = list()
-- 
2.8.1

