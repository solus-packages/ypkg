From a8806dbe809c6149800e8ec041d5968175177e19 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 10 Apr 2016 23:41:25 +0100
Subject: [PATCH 8/8] Always ensure we have *some* kind of build directory

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 ypkg2/main.py    |  8 ++++++++
 ypkg2/sources.py | 17 ++++++++++-------
 2 files changed, 18 insertions(+), 7 deletions(-)

diff --git a/ypkg2/main.py b/ypkg2/main.py
index f34effc..1210219 100644
--- a/ypkg2/main.py
+++ b/ypkg2/main.py
@@ -288,6 +288,14 @@ def build_package(filename, outputDir):
                         sys.exit(1)
 
             work_dir = manager.get_working_dir(context)
+            if not os.path.exists(work_dir):
+                try:
+                    os.makedirs(work_dir, mode=00755)
+                except Exception as e:
+                    console_ui.emit_error("Source", "Error creating directory")
+                    print(e)
+                    sys.exit(1)
+
             r_step = steps[step]
             if not r_step:
                 continue
diff --git a/ypkg2/sources.py b/ypkg2/sources.py
index de62c3f..87251a1 100644
--- a/ypkg2/sources.py
+++ b/ypkg2/sources.py
@@ -227,10 +227,13 @@ class SourceManager:
         build_dir = context.get_build_dir()
 
         source0 = self.sources[0].filename
-        items = os.listdir(build_dir)
-        if len(items) == 1:
-            return os.path.join(build_dir, items[0])
-        for item in items:
-            if source0.startswith(item):
-                return os.path.join(build_dir, item)
-        return build_dir
+        if os.path.exists(build_dir):
+            items = os.listdir(build_dir)
+            if len(items) == 1:
+                return os.path.join(build_dir, items[0])
+            for item in items:
+                if source0.startswith(item):
+                    return os.path.join(build_dir, item)
+            return build_dir
+        else:
+            return build_dir
-- 
2.8.1

