From 4cfabbe3c0a4765e97714afa4de7a0eef75d68a4 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 10 Apr 2016 07:11:24 +0100
Subject: [PATCH 3/9] Support the libsplit bool property again

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 ypkg2/packages.py | 13 +++++++++----
 ypkg2/ypkgspec.py |  2 ++
 2 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/ypkg2/packages.py b/ypkg2/packages.py
index bdec395..24c1865 100644
--- a/ypkg2/packages.py
+++ b/ypkg2/packages.py
@@ -143,10 +143,16 @@ class PackageGenerator:
         self.add_pattern("/usr/share/doc", "main")
         self.add_pattern("/usr/share/{}".format(spec.pkg_name), "main")
 
-        # TODO: Make this come from a config file!
-        self.add_pattern("/usr/lib64/lib*.so", "devel")
+        if spec.pkg_libsplit:
+            self.add_pattern("/usr/lib64/lib*.so", "devel")
+            self.add_pattern("/usr/lib/lib*.so", "devel")
+            self.add_pattern("/usr/lib32/lib*.so", "32bit-devel")
+        else:
+            self.add_pattern("/usr/lib64/lib*.so", "main")
+            self.add_pattern("/usr/lib/lib*.so", "main")
+            self.add_pattern("/usr/lib32/lib*.so", "32bit")
+
         self.add_pattern("/usr/lib64/lib*.a", "devel")
-        self.add_pattern("/usr/lib/lib*.so", "devel")
         self.add_pattern("/usr/lib/lib*.a", "devel")
         self.add_pattern("/usr/lib/pkgconfig/*.pc", "devel")
         self.add_pattern("/usr/lib64/pkgconfig/*.pc", "devel")
@@ -157,7 +163,6 @@ class PackageGenerator:
         self.add_pattern("/usr/share/aclocal/*.m4", "devel")
         self.add_pattern("/usr/share/aclocal/*.ac", "devel")
 
-        self.add_pattern("/usr/lib32/lib*.so", "32bit-devel")
         self.add_pattern("/usr/lib32/lib*.a", "32bit-devel")
         self.add_pattern("/usr/lib32/pkgconfig/*.pc", "32bit-devel")
         self.add_pattern("/usr/lib32/lib*.so.*", "32bit")
diff --git a/ypkg2/ypkgspec.py b/ypkg2/ypkgspec.py
index 6cbe759..a7accc9 100644
--- a/ypkg2/ypkgspec.py
+++ b/ypkg2/ypkgspec.py
@@ -87,6 +87,7 @@ class YpkgSpec:
     pkg_autodep = True
     pkg_extract = True
     pkg_optimize = None
+    pkg_libsplit = True
 
     # Dependencies
     pkg_builddeps = None
@@ -188,6 +189,7 @@ class YpkgSpec:
             ("emul32", bool),
             ("autodep", bool),
             ("extract", bool),
+            ("libsplit", bool),
             ("patterns", MultimapFormat(self, self.add_pattern, "main")),
             ("builddeps", OneOrMoreString),
             ("rundeps", MultimapFormat(self, self.add_rundep, "main")),
-- 
2.8.1

