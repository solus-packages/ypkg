From b5d622469aa74affb81110824eded0301fbaab9d Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Sun, 10 Apr 2016 09:44:44 +0100
Subject: [PATCH 05/11] Correctly fallback to 32bit through priority

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 ypkg2/packages.py | 14 ++++++++++----
 1 file changed, 10 insertions(+), 4 deletions(-)

diff --git a/ypkg2/packages.py b/ypkg2/packages.py
index 24c1865..9b8f00a 100644
--- a/ypkg2/packages.py
+++ b/ypkg2/packages.py
@@ -138,7 +138,10 @@ class PackageGenerator:
         self.add_pattern("/usr/share/info", "main")
         self.add_pattern("/usr/lib64/lib*.so.*", "main")
         self.add_pattern("/usr/lib/lib*.so.*", "main")
-        self.add_pattern("/usr/lib32/lib*.so.*", "32bit")
+        self.add_pattern("/usr/lib32/", "32bit")
+        self.add_pattern("/usr/lib32/lib*.so.*", "32bit",
+                         priority=PRIORITY_DEFAULT+1)
+
         self.add_pattern("/usr/share/locale", "main")
         self.add_pattern("/usr/share/doc", "main")
         self.add_pattern("/usr/share/{}".format(spec.pkg_name), "main")
@@ -146,11 +149,14 @@ class PackageGenerator:
         if spec.pkg_libsplit:
             self.add_pattern("/usr/lib64/lib*.so", "devel")
             self.add_pattern("/usr/lib/lib*.so", "devel")
-            self.add_pattern("/usr/lib32/lib*.so", "32bit-devel")
+            self.add_pattern("/usr/lib32/lib*.so", "32bit-devel",
+                             priority=PRIORITY_DEFAULT+1)
+
         else:
             self.add_pattern("/usr/lib64/lib*.so", "main")
             self.add_pattern("/usr/lib/lib*.so", "main")
-            self.add_pattern("/usr/lib32/lib*.so", "32bit")
+            self.add_pattern("/usr/lib32/lib*.so", "32bit",
+                             priority=PRIORITY_DEFAULT+1)
 
         self.add_pattern("/usr/lib64/lib*.a", "devel")
         self.add_pattern("/usr/lib/lib*.a", "devel")
@@ -158,7 +164,7 @@ class PackageGenerator:
         self.add_pattern("/usr/lib64/pkgconfig/*.pc", "devel")
         self.add_pattern("/usr/include/", "devel")
         self.add_pattern("/usr/share/man3/", "devel",
-                         priority=PRIORITY_USER+1)
+                         priority=PRIORITY_DEFAULT+1)
         self.add_pattern("/usr/share/man", "main")
         self.add_pattern("/usr/share/aclocal/*.m4", "devel")
         self.add_pattern("/usr/share/aclocal/*.ac", "devel")
-- 
2.8.1

